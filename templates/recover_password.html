{% extends 'base.html' %}
{% block content %}
    <div class="auth-form">
        <h2>Account Recovery</h2>
        
        {% if stage == 'username' %}
            <p class="auth-switch">Enter your username or email to retrieve your security question.</p>
            <form action="{{ url_for('recover_password') }}" method="POST">
                <input type="hidden" name="action" value="find_user">
                <label for="username_or_email">Username or Email</label>
                <input type="text" name="username_or_email" id="username_or_email" required>
                <button type="submit" class="btn-dark">Next</button>
            </form>
        
        {% elif stage == 'answer' and question %}
            <p class="auth-switch">To reset your password, answer your security question below.</p>
            
            <form action="{{ url_for('recover_password') }}" method="POST">
                <input type="hidden" name="action" value="reset_password">
                <input type="hidden" name="user_id" value="{{ user_id }}">
                
                <label for="security_question">Security Question:</label>
                <p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 1rem;">{{ question }}</p>
                
                <label for="submitted_answer">Your Answer</label>
                <input type="text" name="submitted_answer" id="submitted_answer" required>
                
                <label for="new_password">New Password</label>
                <input type="password" name="new_password" id="new_password" required>
                
                <button type="submit" class="btn-dark">Verify & Reset</button>
            </form>
            
        {% else %}
            <p>An error occurred during recovery initialization. Please try again.</p>
            <a href="{{ url_for('login') }}" class="btn-dark">Return to Login</a>
        {% endif %}
        
    </div>
{% endblock %}